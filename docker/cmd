#!/bin/sh

case "${MODE}" in
  receiver)
    if [ -z "${TLSRPT_RECEIVER_SOCKETNAME}" ]; then
      # see https://github.com/sys4/tlsrpt/issues/26
      # this way, postfix (and any other user) can write
      umask 0000

      TLSRPT_RECEIVER_SOCKETNAME='/tlsrpt-socket/receiver.socket'
      export TLSRPT_RECEIVER_SOCKETNAME
    fi
    cmd='/usr/local/bin/tlsrpt-receiver'
    ;;
  reporter)
    cmd='/usr/local/bin/tlsrpt-reporter'
    ;;
  *)
    cmd='/bin/bash'
    ;;
esac

exec $cmd
